# Jenkins Helm Chart Values for Azure AKS
# helm install jenkins jenkins/jenkins -f jenkins-values.yaml -n jenkins

controller:
  componentName: "jenkins-controller"
  image: "jenkins/jenkins"
  tag: "2.426.2-lts-jdk17"
  imagePullPolicy: "IfNotPresent"

  resources:
    requests:
      cpu: "500m"
      memory: "1Gi"
    limits:
      cpu: "2000m"
      memory: "4Gi"

  # Jenkins URL
  jenkinsUrl: "https://jenkins.bloberry.cloud"

  # Admin 사용자 설정
  adminUser: "admin"

  # 서비스 설정
  serviceType: ClusterIP

  # Ingress 설정 (Application Gateway 사용)
  ingress:
    enabled: true
    apiVersion: "networking.k8s.io/v1"
    annotations:
      kubernetes.io/ingress.class: azure/application-gateway
      appgw.ingress.kubernetes.io/ssl-redirect: "true"
      appgw.ingress.kubernetes.io/backend-protocol: "http"
      appgw.ingress.kubernetes.io/health-probe-path: "/login"
    hostName: jenkins.bloberry.cloud
    tls:
      - hosts:
          - jenkins.bloberry.cloud
        secretName: jenkins-tls

  # JCasC (Jenkins Configuration as Code)
  JCasC:
    defaultConfig: true
    configScripts:
      welcome-message: |
        jenkins:
          systemMessage: "Welcome to Jenkins for Azure AKS CI/CD Pipeline"

      azure-credentials: |
        credentials:
          system:
            domainCredentials:
              - credentials:
                  - azure:
                      scope: GLOBAL
                      id: "azure-service-principal"
                      subscriptionId: "${AZURE_SUBSCRIPTION_ID}"
                      clientId: "${AZURE_CLIENT_ID}"
                      clientSecret: "${AZURE_CLIENT_SECRET}"
                      tenant: "${AZURE_TENANT_ID}"
                      description: "Azure Service Principal"
                  - usernamePassword:
                      scope: GLOBAL
                      id: "github-credentials"
                      username: "${GITHUB_USERNAME}"
                      password: "${GITHUB_TOKEN}"
                      description: "GitHub Credentials"
                  - string:
                      scope: GLOBAL
                      id: "argocd-token"
                      secret: "${ARGOCD_TOKEN}"
                      description: "ArgoCD Auth Token"
                  - string:
                      scope: GLOBAL
                      id: "sonarqube-token"
                      secret: "${SONARQUBE_TOKEN}"
                      description: "SonarQube Token"

      jobs: |
        jobs:
          - script: >
              multibranchPipelineJob('petclinic-azure') {
                  branchSources {
                      github {
                          id('petclinic-azure-github')
                          scanCredentialsId('github-credentials')
                          repoOwner('your-org')
                          repository('spring-petclinic')
                      }
                  }
                  orphanedItemStrategy {
                      discardOldItems {
                          numToKeep(10)
                      }
                  }
              }

  # 플러그인 설치
  installPlugins:
    - kubernetes:4029.v5712230ccb_f8
    - workflow-aggregator:596.v8c21c963d92d
    - git:5.2.0
    - github:1.37.3.1
    - github-branch-source:1775.v50b_d9fc54d2c
    - configuration-as-code:1775.v810dc950b_514
    - sonar:2.16.1
    - slack:684.v833089650554
    - docker-workflow:572.v950f58993843
    - azure-credentials:254.v64da_8176c83a
    - azure-ad:424.v1cd5a_4cddfd4
    - azure-container-agents:261.vf2f82e8a_b_2e3
    - kubernetes-credentials-provider:1.234.vf3013b_35f5b_a
    - blueocean:1.27.9
    - job-dsl:1.87

  # ServiceAccount 설정
  serviceAccount:
    create: true
    name: jenkins
    annotations:
      azure.workload.identity/client-id: "CLIENT_ID"

# Agent 설정
agent:
  enabled: true
  namespace: jenkins
  containerCap: 10
  podRetention: "Never"

  resources:
    requests:
      cpu: "512m"
      memory: "512Mi"
    limits:
      cpu: "2000m"
      memory: "2Gi"

# 영구 볼륨 설정
persistence:
  enabled: true
  storageClass: "managed-premium"
  size: "50Gi"

# RBAC 설정
rbac:
  create: true
  readSecrets: true
