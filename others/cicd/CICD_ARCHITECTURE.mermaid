---
title: CI/CD 파이프라인 아키텍처 (Tekton + FluxCD)
---
flowchart TB
    Developer["개발자<br/>Code Commit"]
    
    subgraph GitHub["GitHub Repository"]
        AppRepo["Application Code<br/>spring-petclinic"]
        InfraRepo["Infrastructure Code<br/>k8s-manifests"]
    end
    
    subgraph CI["CI Pipeline (Tekton on AWS EKS)"]
        direction TB
        
        Webhook["GitHub Webhook<br/>Trigger"]
        
        subgraph TektonPipeline["Tekton Pipeline"]
            direction TB
            CloneTask["1. Clone Source<br/>git-clone"]
            BuildTask["2. Build App<br/>maven/gradle"]
            TestTask["3. Run Tests<br/>unit + integration"]
            DockerBuildTask["4. Docker Build<br/>kaniko"]
            DockerPushTask["5. Push to DockerHub<br/>petclinic:v1.0.0"]
            UpdateManifestTask["6. Update Manifests<br/>yq/kustomize"]
        end
        
        TektonDashboard["Tekton Dashboard<br/>Pipeline 모니터링"]
    end
    
    subgraph Registry["Container Registry"]
        DockerHub["DockerHub<br/>username/petclinic<br/>Public/Private"]
    end
    
    subgraph CD["CD Pipeline (FluxCD on AWS EKS)"]
        direction TB
        
        FluxSource["Flux Source Controller<br/>GitRepository 감지"]
        FluxKustomize["Flux Kustomize Controller<br/>매니페스트 적용"]
        FluxHelm["Flux Helm Controller<br/>Helm Chart 관리"]
        FluxImage["Flux Image Automation<br/>이미지 업데이트"]
        FluxNotify["Flux Notification<br/>Slack/Email"]
    end
    
    subgraph AWSEKS["AWS EKS Cluster"]
        direction LR
        
        subgraph Namespaces["Namespaces"]
            TektonNS["tekton-pipelines<br/>CI 워크로드"]
            FluxNS["flux-system<br/>CD 워크로드"]
            PetclinicNS["petclinic<br/>Application"]
        end
        
        subgraph Workloads["Application Workloads"]
            WebPods["Web Pods<br/>Nginx"]
            WASPods["WAS Pods<br/>Spring Boot"]
        end
    end
    
    subgraph AzureDR["Azure DR Site"]
        AzureFlux["FluxCD<br/>(선택사항)<br/>동일 매니페스트"]
        AzureVMs["VMs<br/>Manual Deploy"]
    end
    
    %% Flow
    Developer -->|"git push"| AppRepo
    AppRepo -->|"webhook"| Webhook
    Webhook --> CloneTask
    CloneTask --> BuildTask
    BuildTask --> TestTask
    TestTask --> DockerBuildTask
    DockerBuildTask --> DockerPushTask
    DockerPushTask -->|"push image"| DockerHub
    DockerPushTask --> UpdateManifestTask
    UpdateManifestTask -->|"update tag"| InfraRepo
    
    InfraRepo -->|"poll/webhook"| FluxSource
    FluxSource --> FluxKustomize
    FluxKustomize --> PetclinicNS
    PetclinicNS --> WebPods
    PetclinicNS --> WASPods
    
    DockerHub -->|"pull image"| WebPods
    DockerHub -->|"pull image"| WASPods
    
    FluxImage -->|"scan new tags"| DockerHub
    FluxImage -->|"auto update"| InfraRepo
    
    FluxNotify -->|"deployment status"| Developer
    TektonDashboard -->|"monitor"| Developer
    
    InfraRepo -.->|"optional"| AzureFlux
    AzureFlux -.-> AzureVMs
    
    %% Styles
    classDef github fill:#24292e,stroke:#fff,stroke-width:2px,color:#fff
    classDef tekton fill:#0095D5,stroke:#00487C,stroke-width:2px,color:#fff
    classDef flux fill:#5468FF,stroke:#2D3748,stroke-width:2px,color:#fff
    classDef docker fill:#2496ED,stroke:#1D63ED,stroke-width:2px,color:#fff
    classDef eks fill:#FF9900,stroke:#232F3E,stroke-width:2px,color:#232F3E
    classDef azure fill:#0078D4,stroke:#003366,stroke-width:2px,color:#fff
    classDef dev fill:#48BB78,stroke:#2F855A,stroke-width:2px,color:#fff
    
    class AppRepo,InfraRepo,GitHub github
    class CloneTask,BuildTask,TestTask,DockerBuildTask,DockerPushTask,UpdateManifestTask,TektonPipeline,TektonDashboard,Webhook tekton
    class FluxSource,FluxKustomize,FluxHelm,FluxImage,FluxNotify,CD flux
    class DockerHub,Registry docker
    class AWSEKS,TektonNS,FluxNS,PetclinicNS,Namespaces,WebPods,WASPods,Workloads eks
    class AzureDR,AzureFlux,AzureVMs azure
    class Developer dev
